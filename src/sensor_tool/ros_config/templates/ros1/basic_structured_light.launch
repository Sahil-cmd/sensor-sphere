<launch>
    <!-- {sensor_description} -->
    <!-- Generated by Sensor Comparison Tool -->

    <!-- Sensor Configuration -->
    <arg name="sensor_serial" default="" />
    <arg name="sensor_name" default="{sensor_id}" />
    <arg name="depth_width" default="{depth_width}" />
    <arg name="depth_height" default="{depth_height}" />
    <arg name="fps" default="{frame_rate}" />

    <!-- Connection Settings -->
    <arg name="connection_type" default="{connection_type}" />
    <arg name="ip_address" default="" />  <!-- For Ethernet-based sensors -->

    <!-- Range Settings -->
    <arg name="min_range" default="{min_range}" />
    <arg name="max_range" default="{max_range}" />

    <!-- Structured Light Specific Settings -->
    <arg name="projector_power" default="100" />  <!-- Projector intensity percentage -->
    <arg name="auto_exposure" default="true" />
    <arg name="exposure_time" default="10000" />  <!-- microseconds -->
    <arg name="gain" default="1.0" />
    <arg name="pattern_count" default="1" />  <!-- Number of projection patterns -->

    <!-- Quality Settings -->
    <arg name="outlier_removal" default="true" />
    <arg name="outlier_threshold" default="5.0" />
    <arg name="smoothing" default="false" />
    <arg name="fill_holes" default="false" />

    <!-- Output Settings -->
    <arg name="enable_depth" default="true" />
    <arg name="enable_pointcloud" default="true" />
    <arg name="enable_normals" default="false" />
    <arg name="enable_texture" default="false" />

    <!-- TF Settings -->
    <arg name="publish_tf" default="true" />
    <arg name="tf_prefix" default="$(arg sensor_name)" />
    <arg name="base_frame" default="$(arg tf_prefix)_link" />
    <arg name="optical_frame" default="$(arg tf_prefix)_optical_frame" />

    <!-- Driver Node -->
    <group ns="$(arg sensor_name)">
        <include file="{driver_include_file}">
            <arg name="serial" value="$(arg sensor_serial)" />
            <arg name="ip" value="$(arg ip_address)" if="$(eval connection_type == 'ethernet')" />

            <!-- Image Settings -->
            <arg name="capture_timeout" value="10000" />
            <arg name="trigger_mode" value="Software" />
            <arg name="pixel_clock" value="24" />
            <arg name="auto_blacklevel" value="true" />
            <arg name="auto_gain" value="$(arg auto_exposure)" />
            <arg name="auto_exposure" value="$(arg auto_exposure)" />
            <arg name="exposure" value="$(arg exposure_time)" />
            <arg name="gain_value" value="$(arg gain)" />

            <!-- Projector Settings -->
            <arg name="projector" value="$(arg projector_power)" />
            <arg name="front_light" value="false" />

            <!-- 3D Settings -->
            <arg name="cloud_timeout" value="30000" />
            <arg name="remove_outliers" value="$(arg outlier_removal)" />
            <arg name="outlier_threshold" value="$(arg outlier_threshold)" />
            <arg name="use_opengl" value="true" />

            <!-- Frame Settings -->
            <arg name="publish_tf" value="$(arg publish_tf)" />
            <arg name="camera_frame" value="$(arg base_frame)" />
            <arg name="target_frame" value="$(arg optical_frame)" />
            <arg name="link_frame" value="$(arg base_frame)" />
        </include>
    </group>

    <!-- Point Cloud Processing (Optional) -->
    <group ns="$(arg sensor_name)" if="$(arg outlier_removal)">
        <node pkg="pcl_ros" type="statistical_outlier_removal" name="outlier_filter">
            <remap from="~input" to="depth/points" />
            <remap from="~output" to="depth/points_filtered" />
            <param name="mean_k" value="50" />
            <param name="stddev" value="$(arg outlier_threshold)" />
        </node>
    </group>

    <!-- Optional: Static Transform Publisher for sensor mount -->
    <node pkg="tf2_ros" type="static_transform_publisher" name="$(arg sensor_name)_mount_publisher"
          args="0 0 0 0 0 0 1 world $(arg base_frame)" if="$(arg publish_tf)" />

</launch>
